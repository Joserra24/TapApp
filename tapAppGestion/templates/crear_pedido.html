{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Crear Pedido</title>
  <link rel="stylesheet" type="text/css" href="{% static 'css/stylesCrearPedido.css' %}">
</head>
<body>
  <header>
    <h1>Crear Pedido</h1>
  </header>

  <main>
    <form id="pedido-form" method="post">
      {% csrf_token %}
      
      <label for="mesa">Mesa:</label>
      {{ form.mesa }}

      <label for="numero_clientes">Número de Clientes:</label>
      {{ form.numero_clientes }}

      <fieldset>
        <legend>Selecciona Productos</legend>

        {% for categoria, productos in categorias.items %}
          <div class="categoria">
            <h3>{{ categoria }}</h3>
            <div class="productos-grid">
              {% for producto in productos %}
                <div class="producto">
                  <input type="checkbox" name="productos" value="{{ producto.id }}" id="producto_{{ producto.id }}" onchange="toggleCantidad('{{ producto.id }}')">
                  <label for="producto_{{ producto.id }}">
                    {{ producto.nombre }} - {{ producto.precio }}€
                  </label>
                  <input type="number" name="cantidad_{{ producto.id }}" id="cantidad_{{ producto.id }}" min="1" value="1" style="display:none;">
                </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}

      </fieldset>

      <input type="hidden" name="cantidades" id="cantidades">
      <button type="submit">Guardar Pedido</button>
    </form>
  </main>

  <script>
    function toggleCantidad(id) {
      const checkbox = document.getElementById('producto_' + id);
      const cantidadInput = document.getElementById('cantidad_' + id);
      if (checkbox.checked) {
        cantidadInput.style.display = 'inline';
      } else {
        cantidadInput.style.display = 'none';
      }
    }

    document.getElementById('pedido-form').addEventListener('submit', function(event) {
      const cantidades = {};
      document.querySelectorAll('input[name^="cantidad_"]').forEach(input => {
        if (input.style.display !== 'none') {
          cantidades[input.name.replace('cantidad_', '')] = input.value;
        }
      });
      document.getElementById('cantidades').value = JSON.stringify(cantidades);
    });
  </script>
</body>
</html>
